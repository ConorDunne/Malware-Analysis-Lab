# VPC Configuration
resource "aws_vpc" "network_vpc" {
  cidr_block = "172.16.0.0/16"

  tags = {
    Name        = "${local.defaults.env}-vpc"
    Environment = "${local.defaults.env}"
  }
}

# Internet Access
resource "aws_internet_gateway" "network_ig" {
  vpc_id = "${aws_vpc.network_vpc.id}"

  tags = {
    Name        = "${local.defaults.env}-igw"
    Environment = "${local.defaults.env}"
  }
}

# S3 Bucket
resource "aws_s3_bucket" "malware_storage" {
  bucket = "${var.env}-s3-bucket"

  tags = {
    Name        = "${local.defaults.env}-s3-bucket"
    Environment = "${local.defaults.env}"
  }
}

# VPC Endpoint for S3 Access
resource "aws_vpc_endpoint" "s3_gateway" {
  depends_on = [
    module.Lab
  ]

  vpc_id            = aws_vpc.network_vpc.id
  service_name      = "com.amazonaws.${var.region}.s3"
  vpc_endpoint_type = "Gateway"

  tags = {
    Name        = "${local.defaults.env}-s3-gateway"
    Environment = "${local.defaults.env}"
  }
}